# 概要

ITSS準拠の研修カリキュラム「プログラミングの基礎(2)（B121）」のうち、「継承」に関する課題と正解例です。

## 事前準備
- 子フォームを作り、接続設定変更機能を実装してもらいます、。そのため、事前に [EDU. Transfer data between forms](https://gitlab.com/it_education/edu.-transfer-data-between-forms) のフォーム間情報連携に関するサンプルコードの解説を行い、フォーム同士での情報連携について理解させてください。
- 研修環境からアクセス可能なSQL Serverに、「Database」ディレクトリにある下記のSQL 2件でテーブルとデータを作成してください。
  - TableCreate.sql …… Monstersテーブルを生成するCreate文です。
  - DataInsert.sql …… Monstersテーブルにポケモンデータを登録するInsert文です。
- MonsterViewer.cs / SimpleSearchの「connectionString」変数に接続先サーバー情報が記述されているので、用意した環境のサーバー、DB名、ID、パスワードに書き換えてください。
- 同じく、Properties / Settings.settings にある接続先情報も書き換えてください。
- 課題用ソースを受講者に配布し、Visual Studioで開ける状態にしてください。



## 課題1: 既存の部品を継承した独自部品を作る

### 新人用課題文
C#（.NET Framework）に元々用意されている、テキストボックスやボタンを改造して、独自の機能をもった部品（コントロール）を作ります。
既存コントロールはすべてクラスとして作られているので、それを継承して独自名を持つコントロールを作れます。この課題では、以下の4つのうちいずれか1つを作り、作ったコントロールをフォームに貼り付けて動きを確認してください。

- 押すたびに色が変わるボタン（CustomButton1）
- 押すたびにボタン表面の表示が「年月日」→「時分秒」に切り替わるボタン（CustomButton2）
- マウスカーソルが上を通過するときだけ色が変わるテキストボックス（CustomTextBox1）
- 文字入力時だけ太字になるテキストボックス（CustomTextBox2）

この課題では、サンプルプログラムにそれぞれのコントロール名に対応した作りかけのソースが用意されているので、処理を追加して完成させましょう。

### 講師用補足
既存コントロールを継承して、独自の処理を追加します。あまり実処理での応用を意識すると難しくなるので、結果としては簡単なものにしてありますがそれぞれ難易度は異なります。

- 押すたびに色が変わるボタン（CustomButton1） …… 難度★☆☆。色を変える方は簡単ですが、戻す際に「何色にすればよいか」が引っかかるポイントと想定されます。標準コントロールはWindowsの設定に従って色が決まっているため、いわゆる「システムカラー」という色が設定されています。システムカラーは「System.Drawing.SystemColors」列挙型に設定されており、ボタン表面は「SystemColors.Control」です。この色ですが、フォームデザイン画面の初期設定でも確認できますし、デバッグモードで実行してブレークをかけ、今何色が設定されているかを見る方法でも確認できます。標準色指定に困っているようであれば助け船を出してあげてください。
- 押すたびにボタン表面の表示が「年月日」→「時分秒」に切り替わるボタン（CustomButton2） …… 難度★★☆。年月日と時刻の表示をClickで入れ替えますが、「今どちらが表示されているか」の判定が引っかかるポイントと想定されます。サンプルでは、年月日の場合の文字数と時分秒の文字数が違う事に着目し、文字数で状況を判定しています。実際の開発ではこの方法だとロケールが異なる地域での動作に支障が出る可能性があるため、今の状態を表すフラグのような情報を併用するのが無難かも知れません。なお、年月日や時刻の表記はDateTime.Nowが持つメソッドで選択指定できるので、そこで詰まっているようであれば助け船を出してあげてください。
- マウスカーソルが上を通過するときだけ色が変わるテキストボックス（CustomTextBox1） …… 難度★☆☆。イベントが2つに分かれるだけで、基本的にはCustomButton1と大差ない内容です。MouseEnterとMouseLeave、それぞれで色の変更と戻し処理を実装します。
- 文字入力時だけ太字になるテキストボックス（CustomTextBox2） …… 難度★★★。テキストボックスのフォントプロパティを、EnterとLeaveイベントで変更すればよいだけのように思えますが、実際にはFontoプロパティの「Style」はReadOnlyになっており変更できません。変更するには太字設定になっている「Font」クラスのインスタンス自体をFontプロパティに設定する必要があります。この点に気づけるかどうかが完成させられるかどうかの境界となります。



---
## 課題2: DLL作成と配布

ここからは作業手順が複雑になるため、実習は講師と一緒に作業するスタイルで実施することをお勧めします。

### 新人用説明文
次に、課題1で作成した独自コントロールを「DLL（Dynamic Link Library）」の形式で作り、別の人に渡して使ってもらいます。下記の手順でクラスライブラリープロジェクトを作り、課題1のプロジェクトからソースをコピーしてください。

1. ソリューションエクスプローラーから「ソリューション名」を右クリックし、「新しいプロジェクト」を選択する。
1. 「新しいプロジェクトの追加」画面で「Windowsデスクトップ」カテゴリーにある「クラスライブラリ」を選択する。名前を「CustomControls」にしてOKを押す。
1. ソリューションエクスプローラーに「CustomControls」が追加されたことを確認し、CustomControlsの中に自動的に作られた「Class1.cs」を削除する。
1. 課題1で作ったボタンやテキストボックスを、ソリューションエクスプローラー上で選択肢、Ctrl+Cで「コピー」する。
1. 上記手順で追加した「CustomControls」を選択肢、Ctrl+Vで「ペースト」する。
1. CustonControlsの「参照」を右クリックして参照の追加を選択し、下記の2ライブラリの参照を追加する。
   - System.Drawing
   - System.Windows.Forms
1. Visual Studio画面上部にある「Debug」を「Release」に変更し、リビルドを実行する。
1. Windowsエクスプローラーでソースがあるフォルダを開き、「bin/Release」フォルダに「CustomControls.dll」ができていることを確認する。

ここまでの作業で、自分で継承/改造したコントロールが入ったDLLファイルが作成できました。次はこれを参照してアプリを作ってみます。

1. Cドライブの直下に「temp/libtest」フォルダーを作る。
1. 先ほどの「CustomControls.dll」を、上記のフォルダーにコピーする。
1. Visual Studioで新しいWindows Formsプロジェクト「CustomControlsTest」を作成する。
1. プロジェクトの「参照」を右クリックして「参照の追加」を選択。次いで表示される「参照マネージャー」で右下の「参照(B)」を押す。
1. 場所は上記手順1.で作ったTemp/libtestフォルダーとDLLファイルを指定。


---
# サンプルソース概略

サンプルは新人に提供する作業用ひな形と、回答サンプルになっています。

## 